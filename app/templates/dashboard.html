{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="flex flex-col h-full p-6 gap-8">

  <h2 class="text-4xl font-bold text-white tracking-wide text-center">ðŸ“Š Attendance Dashboard</h2>

  <!-- Stat Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 text-center">
    <div class="bg-gray-900 p-6 rounded-2xl shadow-xl border border-gray-700">
      <h3 class="text-gray-400 text-sm uppercase">Total Students</h3>
      <p class="text-4xl font-bold text-white mt-2">{{ total_students }}</p>
    </div>
    <div class="bg-gray-900 p-6 rounded-2xl shadow-xl border border-gray-700">
      <h3 class="text-gray-400 text-sm uppercase">Total Events</h3>
      <p class="text-4xl font-bold text-white mt-2">{{ total_events }}</p>
    </div>
    <div class="bg-gray-900 p-6 rounded-2xl shadow-xl border border-gray-700">
      <h3 class="text-gray-400 text-sm uppercase">ON-Time (All Events)</h3>
      <p class="text-4xl font-bold text-green-400 mt-2">{{ total_present }}</p>
      <p class="text-sm text-gray-400 mt-1">Rate: {{ attendance_rate }}</p>
    </div>
    <div class="bg-gray-900 p-6 rounded-2xl shadow-xl border border-gray-700">
      <h3 class="text-gray-400 text-sm uppercase">Late</h3>
      <p class="text-4xl font-bold text-yellow-400 mt-2">{{ total_late }}</p>
      <p class="text-sm text-gray-400 mt-1">({{ late_percentage }})</p>
    </div>
    <div class="bg-gray-900 p-6 rounded-2xl shadow-xl border border-gray-700">
      <h3 class="text-gray-400 text-sm uppercase">Absent</h3>
      <p class="text-4xl font-bold text-red-400 mt-2">{{ total_absent }}</p>
      <p class="text-sm text-gray-400 mt-1">({{ absent_percentage }})</p>
    </div>
  </div>

  <div class="flex flex-col lg:flex-row gap-8 mt-6">

    <!-- Recent Events -->
    <div class="bg-gray-900 border border-gray-700 rounded-2xl shadow-xl flex flex-col p-6 flex-1">
      <h3 class="text-2xl font-semibold text-gray-100 mb-4">Recent Events</h3>
      <div class="grid grid-cols-1 gap-4">
        {% for event in events[:5] %}
        <div class="bg-gray-800 p-4 rounded-lg hover:bg-gray-700 transition flex justify-between items-center">
          <div>
            <p class="text-white font-medium text-lg">{{ event.event_name }}</p>
            <p class="text-gray-300 text-sm">{{ event.event_date }}</p>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Attendance Chart -->
    <div class="bg-gray-900 border border-gray-700 rounded-2xl shadow-xl p-6 flex-1">
      <h3 class="text-2xl font-semibold text-gray-100 mb-4 text-center">Overall Attendance Breakdown (%)</h3>
      <canvas id="attendanceChart" class="w-full h-72"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('attendanceChart').getContext('2d');
new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ["On-Time", "Late", "Absent"],
        datasets: [{
            label: "Percentage",
            data: [
              parseFloat("{{ attendance_rate|replace('%','') }}"),
              parseFloat("{{ late_percentage|replace('%','') }}"),
              parseFloat("{{ absent_percentage|replace('%','') }}")
            ],
            backgroundColor: [
              'rgba(34,197,94,0.7)',   // Green
              'rgba(234,179,8,0.7)',   // Yellow
              'rgba(220,38,38,0.7)'    // Red
            ],
            borderColor: [
              'rgba(34,197,94,1)',
              'rgba(234,179,8,1)',
              'rgba(220,38,38,1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: { 
            callbacks: {
              label: (context) => context.raw + "%"
            }
          }
        },
        scales: { 
          y: { 
            beginAtZero: true, 
            max: 100,
            ticks: { color: 'white', callback: val => val + "%" } 
          },
          x: { ticks: { color: 'white' } }
        }
    }
});
</script>
{% endblock %}
